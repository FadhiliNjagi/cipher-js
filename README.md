# symmetric-cipher.js
This is a lightweight library meant for symmetric encryption and decryption of strings. It is written for express-js to add support for encrypted cookies, but will also work with Node.js.

This library currently only allows users to use 'AES-256-CBC' symmetric algorithm. On encryption, a random IV is computed and prepended to the ciphertext with `:` as the separator. This library uses the in-built Node.js `crypto` library under the hood.

256-bit (32-byte) keys are required for encryption or decryption. To avoid imposing strict requirements, this library automatically generates a sha256 hash of the key if it is not the required length. However, it is not recommended to use short keys like 'super secret key', though they will still work.

See the Security section for tips on generating keys.

## Installation
NPM
```bash
npm install symmetric-cipher.js
```
Yarn
```bash
yarn add symmetric-cipher.js
```

## Usage
```javascript
var cipher = require('symmetric-cipher.js');

// Encrypt
cipher.encrypt('my value', 'super secret key');
// cf20922dd618009f4ee9172ac746701f:c7e37061e6486e3f574aae8f110e8831

// Decrypt
cipher.decrypt('ciphertext', 'super secret key');
// foobar
```

ES Modules
```javascript
import { encrypt, decrypt } from 'symmetric-cipher.js';

// Encrypt
encrypt('foobar', 'super secret key');
// cf20922dd618009f4ee9172ac746701f:c7e37061e6486e3f574aae8f110e8831

// Decrypt
decrypt('cf20922dd618009f4ee9172ac746701f:c7e37061e6486e3f574aae8f110e8831', 'super secret key');
// foobar
```

## Security
The key used for encryption and decryption should be a long, random string. The longer the key, the more secure the encryption. A 32-byte (256-bit) key in this case is sufficient. The key should be stored securely.

### Generating a hex key
```bash
node
crypto.randomBytes(32).toString('hex')
```
Example: `37f3ce113b34e789ae76ee238c8aa349a6b163e81c283144bffb9c17328360d1`

### Generating a base64 key
```bash
node
crypto.randomBytes(32).toString('base64')
```
Example: `ktFZQO5JDd4wjwPB2U6bawZKUTGbgOfw6up0wFtjsVk=`


**NOTE:** For keys generated by the above commands, don't forget to specify the encoding. See the Examples section below.

Store the key securely. For Node.js, you can store it in a `.env` file and use [dotenv](https://github.com/motdotla/dotenv) library to load it into your application. Don't store your key in version control. Add `.env` to `.gitignore`.

## API
### **encrypt(plainText, key, keyEncoding)**

- `plaintext` (string) The string to encrypt
- `key`: (string | Buffer) The secret used for encryption or decryption. If it is a string, it is converted from the specified encoding to binary.
- `keyEncoding` (string) The encoding of the key. Default is `utf8`. Others include `base64`, `hex`, `ascii`. For full details see crypto's BufferEncoding.

Output is in the format {32-character-iv}:{ciphertext}

### **decrypt(cipherText, key, keyEncoding)**
Expected input is in the format {32-character-iv}:{ciphertext}

- `cipherText` (string) The cipher to decrypt
- `key`: (string | Buffer) The secret used for encryption or decryption. If it is a string, it is converted from the specified encoding to binary.
- `keyEncoding` (string) The encoding of the key. Default is 'utf8'. Others include 'base64', 'hex', 'ascii'. For full details see crypto's BufferEncoding.

Output is the original plaintext.

## Examples
Hex key
```javascript
var cipher = require('symmetric-cipher.js');

cipher.encrypt('foobar', '3fac1504251a027465981346fb5b0d57d398e4df4a03253a4c7d1926e40e9907', 'hex')

cipher.decrypt('cf20922dd618009f4ee9172ac746701f:c7e37061e6486e3f574aae8f110e8831', '3fac1504251a027465981346fb5b0d57d398e4df4a03253a4c7d1926e40e9907', 'hex')
```

Base64 key
```javascript
var cipher = require('symmetric-cipher.js');

cipher.encrypt('foobar', 'ktFZQO5JDd4wjwPB2U6bawZKUTGbgOfw6up0wFtjsVk=', 'base64')

cipher.decrypt('cf20922dd618009f4ee9172ac746701f:c7e37061e6486e3f574aae8f110e8831', 'ktFZQO5JDd4wjwPB2U6bawZKUTGbgOfw6up0wFtjsVk=', 'base64')
```

Key as Buffer object (binary)
```javascript
var cipher = require('symmetric-cipher.js');

var key = Buffer.from('3fac1504251a027465981346fb5b0d57d398e4df4a03253a4c7d1926e40e9907', 'hex')

cipher.encrypt('foobar', key)

cipher.decrypt('cf20922dd618009f4ee9172ac746701f:c7e37061e6486e3f574aae8f110e8831', key)
```

## License
MIT

## Author
[Fadhili Njagi](https://github.com/FadhiliNjagi)
